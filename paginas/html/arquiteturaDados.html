<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitetura de Dados - RRIA</title>

    <link rel="stylesheet" href="../css/arquiteturaDados.css">
    <link rel="stylesheet" href="../css/shared-header.css">

    <!-- Fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <header class="ops-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>Arquitetura de Dados</h1>
                    <p>Estrutura de dados otimizada para decisões em tempo real</p>
                </div>

                <button onclick="window.location.href='../../mapa.html'"
                    style="background:none; border:none; cursor:pointer; color:#666;">
                    <span class="material-icons-round">arrow_back</span>
                </button>
            </div>
        </header>

        <div class="main-layout fade-in">

            <!-- Painel Esquerdo: Raio-X e Informações -->
            <div class="card xray-container">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="card-icon" viewBox="0 0 24 24">
                            <path
                                d="M20,18H4V8H20M20,6H12L10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6Z" />
                        </svg>
                        Painel Raio-X
                    </h3>
                </div>

                <div class="info-block">
                    <div class="info-label">ENTIDADE SELECIONADA</div>
                    <div class="xray-content" id="xray-entity-name">Nenhuma seleção</div>
                </div>

                <div class="info-block">
                    <div class="info-label">ATRIBUTOS E DETALHES</div>
                    <div class="xray-content" id="xray-details">
                        Clique em uma entidade do diagrama ao lado para ver os detalhes da estrutura de dados.
                    </div>
                </div>

                <button id="btn-reset-view"
                    style="margin-top: auto; padding: 12px; background: #5a99d4; color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600;">
                    <svg style="width:20px;height:20px;fill:white" viewBox="0 0 24 24">
                        <path
                            d="M12,5V1L7,6L12,11V7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12H5A7,7 0 0,0 12,19A7,7 0 0,0 19,12A7,7 0 0,0 12,5Z" />
                    </svg>
                    Resetar Visualização
                </button>
            </div>

            <!-- Painel Central/Direito: DER Interativo -->
            <div class="card der-container">
                <div class="der-wrapper" id="der-wrapper">
                    <svg id="der-svg" viewBox="0 0 900 650" preserveAspectRatio="xMidYMid meet">

                        <defs>
                            <style>
                                <![CDATA[
                                .entity-box {
                                    fill: white;
                                    stroke: #002C47;
                                    stroke-width: 2px;
                                    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
                                    transition: all 0.3s;
                                }

                                .relation-shape {
                                    fill: white;
                                    stroke: #4a4a4a;
                                    stroke-width: 2px;
                                    transition: all 0.3s;
                                }

                                .conn-line {
                                    stroke: #333;
                                    stroke-width: 2px;
                                    fill: none;
                                }

                                .entity-title {
                                    font-family: 'Inter', sans-serif;
                                    font-size: 14px;
                                    font-weight: 700;
                                    fill: #002C47;
                                    text-anchor: middle;
                                }

                                .relation-text {
                                    font-family: 'Inter', sans-serif;
                                    font-size: 11px;
                                    font-weight: 600;
                                    fill: #333;
                                    text-anchor: middle;
                                    pointer-events: none;
                                }

                                .cardinality-text {
                                    font-family: 'Inter', sans-serif;
                                    font-size: 12px;
                                    fill: #666;
                                    text-anchor: middle;
                                }

                                .attr-text {
                                    font-family: 'Inter', sans-serif;
                                    font-size: 11px;
                                    fill: #444;
                                    pointer-events: none;
                                }

                                .entity-group,
                                .relation-group {
                                    cursor: pointer;
                                }

                                .entity-group:hover .entity-box {
                                    stroke: #5a99d4;
                                    stroke-width: 3px;
                                }

                                .relation-group:hover .relation-shape {
                                    stroke: #5a99d4;
                                    stroke-width: 3px;
                                }
                                ]]>
                            </style>
                            <marker id="arrow-end" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"
                                markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#333" />
                            </marker>
                        </defs>

                        <!-- GRUPO PRINCIPAL -->
                        <g id="der-artboard">

                            <!-- LINHAS DE CONEXÃO -->
                            <path class="conn-line" d="M210,80 L590,80" />
                            <path class="conn-line" d="M650,110 L650,290" />
                            <path class="conn-line" d="M590,320 L210,320" />
                            <path class="conn-line" d="M150,350 L150,530" />

                            <!-- RELACIONAMENTOS (Losangos) -->
                            <g class="relation-group" transform="translate(400, 80)" data-name="Contém"
                                data-type="relation">
                                <polygon points="0,-25 35,0 0,25 -35,0" class="relation-shape" />
                                <text y="4" class="relation-text">Contém</text>
                            </g>

                            <g class="relation-group" transform="translate(650, 200)" data-name="Composição"
                                data-type="relation">
                                <polygon points="0,-25 55,0 0,25 -55,0" class="relation-shape" />
                                <text y="4" class="relation-text">Composição</text>
                            </g>

                            <g class="relation-group" transform="translate(400, 320)" data-name="Afetar"
                                data-type="relation">
                                <polygon points="0,-25 35,0 0,25 -35,0" class="relation-shape" />
                                <text y="4" class="relation-text">Afetar</text>
                            </g>

                            <g class="relation-group" transform="translate(150, 440)" data-name="Acontecimento"
                                data-type="relation">
                                <polygon points="0,-25 60,0 0,25 -60,0" class="relation-shape" />
                                <text y="4" class="relation-text">Acontecimento</text>
                            </g>

                            <!-- CARDINALIDADES E PAPÉIS -->
                            <text x="260" y="70" class="cardinality-text">(1,1) pertence a</text>
                            <text x="540" y="70" class="cardinality-text">(1,n) tem</text>
                            <text x="700" y="140" class="cardinality-text" text-anchor="start">(0,n) composta</text>
                            <text x="690" y="275" class="cardinality-text" text-anchor="start">(1,n) de</text>
                            <text x="550" y="310" class="cardinality-text">(0,n) afeta</text>
                            <text x="260" y="310" class="cardinality-text">(1,n) afetada</text>
                            <text x="190" y="380" class="cardinality-text" text-anchor="start">(1,n) ocorre</text>
                            <text x="180" y="520" class="cardinality-text" text-anchor="start">(1,1) em</text>

                            <!-- ENTIDADES -->
                            <g id="entity-rua" class="entity-group" transform="translate(150, 80)" data-name="Rua"
                                data-type="entity" data-attrs="idRua (PK), nome, velocidade, sentido">
                                <rect x="-60" y="-30" width="120" height="60" class="entity-box" rx="4" />
                                <text x="0" y="5" class="entity-title">Rua</text>
                                <circle cx="-50" cy="-45" r="3" fill="black" />
                                <text x="-42" y="-42" class="attr-text" font-weight="bold">idRua</text>
                                <circle cx="-50" cy="-60" r="3" fill="white" stroke="#333" />
                                <text x="-42" y="-57" class="attr-text">nome</text>
                            </g>

                            <g id="entity-trecho" class="entity-group" transform="translate(650, 80)" data-name="Trecho"
                                data-type="entity" data-attrs="idTrecho (PK), inicio, fim, distancia">
                                <rect x="-60" y="-30" width="120" height="60" class="entity-box" rx="4" />
                                <text x="0" y="5" class="entity-title">Trecho</text>
                                <circle cx="-50" cy="-45" r="3" fill="black" />
                                <text x="-42" y="-42" class="attr-text" font-weight="bold">idTrecho</text>
                                <circle cx="-50" cy="-60" r="3" fill="white" stroke="#333" />
                                <text x="-42" y="-57" class="attr-text">distancia</text>
                            </g>

                            <g id="entity-rota" class="entity-group" transform="translate(650, 320)" data-name="Rota"
                                data-type="entity" data-attrs="idRota (PK), origem, destino, tempoPrevisto">
                                <rect x="-60" y="-30" width="120" height="60" class="entity-box" rx="4" />
                                <text x="0" y="5" class="entity-title">Rota</text>
                                <circle cx="-50" cy="-45" r="3" fill="black" />
                                <text x="-42" y="-42" class="attr-text" font-weight="bold">idRota</text>
                                <circle cx="-50" cy="-60" r="3" fill="white" stroke="#333" />
                                <text x="-42" y="-57" class="attr-text">tempo</text>
                            </g>

                            <g id="entity-evento" class="entity-group" transform="translate(150, 320)"
                                data-name="Evento" data-type="entity"
                                data-attrs="idEvento (PK), tipo, impacto, localizacao">
                                <rect x="-60" y="-30" width="120" height="60" class="entity-box" rx="4" />
                                <text x="0" y="5" class="entity-title">Evento</text>
                                <circle cx="-50" cy="-45" r="3" fill="black" />
                                <text x="-42" y="-42" class="attr-text" font-weight="bold">idEvento</text>
                                <circle cx="-50" cy="-60" r="3" fill="white" stroke="#333" />
                                <text x="-42" y="-57" class="attr-text">tipo</text>
                            </g>

                            <g id="entity-ponto" class="entity-group" transform="translate(150, 560)" data-name="Ponto"
                                data-type="entity" data-attrs="idPonto (PK), latitude, longitude, tipoPonto">
                                <rect x="-60" y="-30" width="120" height="60" class="entity-box" rx="4" />
                                <text x="0" y="5" class="entity-title">Ponto</text>
                                <circle cx="-58" cy="-45" r="3" fill="black" />
                                <text x="-50" y="-42" class="attr-text" font-weight="bold">idPonto</text>
                                <circle cx="-58" cy="-60" r="3" fill="white" stroke="#333" />
                                <text x="-50" y="-57" class="attr-text">lat/long</text>
                            </g>

                        </g>
                    </svg>

                    <!-- Mini Mapa -->
                    <div class="mini-map-container">
                        <div id="mini-map" class="mini-map-content">
                            <!-- SVG Copiado via JS será inserido aqui -->
                        </div>
                        <!-- Viewport indicator será inserido via JS -->
                    </div>

                    <!-- Controles de Zoom -->
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="btn-zoom-in" title="Aumentar Zoom">+</button>
                        <button class="zoom-btn" id="btn-zoom-out" title="Diminuir Zoom">-</button>
                        <button class="zoom-btn" id="btn-fit-screen" title="Ajustar à Tela">⟳</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/arquiteturaDados.js"></script>
</body>

</html>